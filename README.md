# project1

## Resnet152v2 모델 활용한 바나나 품질 분류

# 데이터셋 탐색

2.바나나 이미지 데이터는 kaggle, github, AI hub 등에서 탐색하였고, 그 중 필요한 데이터들만 추출하였습니다.  

3.데이터 형식과 분류된 형태가 각기 달라서 데이터의 형식을 jpg 포맷으로 통일시키고, 라벨링을 진행하여 품질이 좋은 것과 나쁜 것으로 분류하는 과정을 거쳤습니다. 결과적으로 2807개의 데이터 수를 가지고 있는 데이터 셋을 만들었습니다.

# 데이터 전처리

실제 가지고 있는 데이터 2807개의 데이터 수보다 많은 데이터를 필요로 하다고 생각하여 전처리 작업을 통해 이미지를 증식하는 과정을 거쳤습니다. Imagedatagenerator는 한개의 같은 이미지를 랜덤하게 회전 시키거나 뒤집는 방식으로 서로 다른 여러장의 이미지로 인식하게 할 수 있습니다. 

최종적으로 2807개에서 33,444개의 데이터를 확보하였고  train, validation, test 데이터로 구분하고 품질에 대한 라벨을 구분하여 데이터셋을 만들었습니다.  해당 분류는 이진분류로 진행하였고 육안으로 봤을 때 품질이 좋은 바나나는 노란색이 많은 것을 중점적으로 보고 대략적으로 바나나 98% 이상이 노란빛깔을 띄는지 확인하였습니다. 

데이터는 모델의 네트워크에 주입되기 전에 부동 소수 타입의 텐서로 적절하게 전처리되어 있어야 합니다. 지금은 데이터가 JPEG 파일로 되어 있으므로 네트워크에 입력하려면 다음 과정을 거칩니다. 
 
1. 사진 파일을 읽는다.
2. JPEG 콘텐츠를 RGB 픽셀 값으로 디코딩한다.
3. 부동 소수 타입의 텐서로 변환한다.
4. 픽셀 값(0에서 255 사이)의 스케일을 [0, 1] 사이로 조정한다. (신경망은 작은 입력 값을 선호하기 때문)
 

# 모델 선정 및 설계

모델은 이미지 분류에 알맞는 cnn을 기반으로 한 resnet152v2 를 사용하였습니다. 컨볼루션 신경망은 합성곱이라는 연산을 통해 이미지의 특성을 추출합니다. 가장 기본적인 연산을 보면 합성곱 연산에는 픽셀 단위에 이미지를 필터 혹은 커널이라는 행렬을 통해 이미지 채널 별로 연산을 진행합니다. 스트라이프는 커널의 이동칸수를 의미한다고 생각하면 됩니다. 필터는 이미지 픽셀에 겹쳐져 스트라이프 수 대로 훑어가며 곱 연산 후 덧셈을 통해 값을 출력합니다. 이 연산 외에도 패딩을 입혀 연산하는 방법도 있습니다. 

딥러닝을 위한 프레임 워크 텐서플로우를 사용하고 그 위에서 구동하는 케라스를 사용하여 모델을 설계했습니다. 케라스는 컨볼루션 신경망을 지원하고 빠르고 간결한 API를 지원하고 사용하기 어렵지 않다는 점에서 사용하였습니다.

모델의 구조를 보면 resnet 모델의 152층에 걸친 컨볼루션 연산을 수행하면서 이미지 특징을 추출합니다. 기존의 모델 네트워크는 입력값에 대해 타겟값을 갖는 함수로 출력을 했지만  다른점은 입력값을 출력값에 더해줌으로서 잔차을 최소화 하는 residual block을 사용하여 층이 깊어짐에따라 에러를 줄일 수 있습니다. 

resnet152v2 파라미터 중 include_top = false 사용하여 추가적인 layer를 삽입하였고input_shape은 train에 사용할 데이터의 크기를 설정하는 파라미터로(224,224,3)을 맞춰주었습니다. 학습모델을 설계할 때, 완전연결계층에서 오버피팅을 줄이기 위해 추가적인 layer를 삽입했고, 활성화함수는 relu, sigmoid함수를 사용했습니다. 마지막 층의 활성화 함수는 다양한 함수가 존재하지만, 
이진 분류를 위해 sigmoid 함수를 사용하였습니다.
글로벌 에버리지 풀링은 3차원의 공간을 1차원으로 줄여 파라미터의 복잡도를 줄여주는 역할을 함으로써 오버피팅을 줄일 수 있습니다. 

# 딥러닝 학습

실제 학습된 내용을 보시면, 7by7 의 각 피쳐 맵에서 평균을 취해 1차원의 벡터 형태로 값을 평면화한것을 볼 수 있습니다. 정보를 잃지만 기존의 완전 연결 계층에 비해 공간적 정보를 덜 잃습니다.

텐서보드를 통해 모델의 학습을 epoch 단위별로 정확도와 손실을 보여주고 있습니다.  주황색은 train data의 그래프이고 파란색은 validation data의 그래프입니다.


